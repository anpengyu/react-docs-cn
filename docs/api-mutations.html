<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">

    <!-- Basic -->
    <title>API: graphql container with mutations | Apollo React Docs</title>
    <meta name="description" content="">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="shortcut icon" type="image/png" href="images/favicon.png" sizes="16x16 32x32 64x64">

    <!-- Social -->
    <meta property="og:type" content="article">
    <meta property="og:url" content="https://apollographqlcn.github.io/react-docs-cn">
    <meta property="og:title" content="API: graphql container with mutations | Apollo React Docs">
    <meta property="og:description" content="">
    <meta property="og:image" content="">
    <meta name="twitter:card" content="summary_image_large">
    <meta name="twitter:site" content="@apollographqlcn">
    <meta name="twitter:title" content="API: graphql container with mutations | Apollo React Docs">
    <meta name="twitter:description" content="">
    <meta name="twitter:image" content="">

    <!-- Misc -->
    <meta name="google-site-verification" content="" />
    <link href='https://fonts.googleapis.com/css?family=Source+Sans+Pro:400,300,200,300italic,400italic' rel='stylesheet' type='text/css'>
    <link rel="stylesheet" href="/style/style.css">
  </head>
  <body class="">
    

<div class="nav dark">
  <div class="nav-group">
    <div class="nav-item show-mobile">
      <span class="js-sidebar-toggle ">
        <span class="icon-menu"></span>
      </span>
    </div>
    <div class="nav-item">
      
      <a class="logo-wrapper" href="http://dev.apollodata.com/" title="Apollo Developers"  >
        <img src="images/logo-apollo-space-left.svg" alt="Apollo" class="logo"/><img src="images/logo-apollo-subbrands-developers-space.svg" class="logo-subbrand" alt="Developers"/>
      </a>
    </div>
  </div>

  <div class="nav-group right">
    
      
      <div class="nav-item show-desktop false ">
        <a class="link" href="http://dev.apollodata.com/react"  >
          <span>React</span>
        </a>
      </div>
    
      
      <div class="nav-item show-desktop false ">
        <a class="link" href="http://dev.apollodata.com/angular2"  >
          <span>Angular</span>
        </a>
      </div>
    
      
      <div class="nav-item show-desktop false ">
        <a class="link" href="http://dev.apollodata.com/ios"  >
          <span>iOS</span>
        </a>
      </div>
    
      
      <div class="nav-item show-desktop false ">
        <a class="link" href="http://dev.apollodata.com/android"  >
          <span>Android</span>
        </a>
      </div>
    
      
      <div class="nav-item show-desktop false ">
        <a class="link" href="http://dev.apollodata.com/core"  >
          <span>Vanilla JS</span>
        </a>
      </div>
    
      
      <div class="nav-item show-desktop false separator">
        <a class="link" href="http://dev.apollodata.com/tools"  >
          <span>Server</span>
        </a>
      </div>
    
      
      <div class="nav-item show-desktop false ">
        <a class="link" href="https://medium.com/apollo-stack" target=_new >
          <span>Blog</span>
        </a>
      </div>
    
      
      <div class="nav-item show-desktop false ">
        <a class="link" href="http://dev.apollodata.com/community"  >
          <span>Community</span>
        </a>
      </div>
    
  </div>
</div>

<div class="sidebar">
  <div class="panel">
    <div class="panel-item">
      <a class="" href="http:/dev.apollodata.com/" title="Apollo"  >
        <span>Apollo Developers</span>
      </a>
    </div>
    
      <div class="panel-item "">
        <a class="" href="http://dev.apollodata.com/react"  >
          <span>React</span>
        </a>
      </div>
    
      <div class="panel-item "">
        <a class="" href="http://dev.apollodata.com/angular2"  >
          <span>Angular</span>
        </a>
      </div>
    
      <div class="panel-item "">
        <a class="" href="http://dev.apollodata.com/ios"  >
          <span>iOS</span>
        </a>
      </div>
    
      <div class="panel-item "">
        <a class="" href="http://dev.apollodata.com/android"  >
          <span>Android</span>
        </a>
      </div>
    
      <div class="panel-item "">
        <a class="" href="http://dev.apollodata.com/core"  >
          <span>Vanilla JS</span>
        </a>
      </div>
    
      <div class="panel-item "">
        <a class="" href="http://dev.apollodata.com/tools"  >
          <span>Server</span>
        </a>
      </div>
    
      <div class="panel-item "">
        <a class="" href="https://medium.com/apollo-stack" target=_new >
          <span>Blog</span>
        </a>
      </div>
    
      <div class="panel-item "">
        <a class="" href="http://dev.apollodata.com/community"  >
          <span>Community</span>
        </a>
      </div>
    
  </div>

  <div class="sidebar-content">
    <div class="topcap">
      <span class="title-sidebar">Apollo React Docs</span>
      
    </div>

    
    <div class="wrapper-search">
      <div class="input-symbol small round">
        <input type="text" placeholder="Search React Guide" id="desktop-search-input" />
        <span class="icon-search"></span>
      </div>
      <div class="wrapper-desktop-search-results"></div>
    </div>

    

    <ul class="toc">
      
        <li>
          
          <ul class="list-toc">
            
              
              <li class="item-toc ">
                <a href="index.html" class="sidebar-link ">
                  <span>Introduction</span>
                </a>
              </li>
            
              
              <li class="item-toc ">
                <a href="initialization.html" class="sidebar-link ">
                  <span>Setup and options</span>
                </a>
              </li>
            
              
              <li class="item-toc ">
                <a href="simple-example.html" class="sidebar-link ">
                  <span>Small Example: Snack</span>
                </a>
              </li>
            
              
              <li class="item-toc ">
                <a href="example-schema.html" class="sidebar-link ">
                  <span>Full Example: GitHunt</span>
                </a>
              </li>
            
              
              <li class="item-toc ">
                <a href="migration.html" class="sidebar-link ">
                  <span>Migrating to 1.0</span>
                </a>
              </li>
            
          </ul>
        </li>
      
        <li>
          
            <div class="heading-toc">Usage</div>
          
          <ul class="list-toc">
            
              
              <li class="item-toc ">
                <a href="queries.html" class="sidebar-link ">
                  <span>Queries</span>
                </a>
              </li>
            
              
              <li class="item-toc ">
                <a href="mutations.html" class="sidebar-link ">
                  <span>Mutations</span>
                </a>
              </li>
            
              
              <li class="item-toc ">
                <a href="subscriptions.html" class="sidebar-link ">
                  <span>Subscriptions</span>
                </a>
              </li>
            
              
              <li class="item-toc ">
                <a href="receiving-updates.html" class="sidebar-link ">
                  <span>Syncing with the Server</span>
                </a>
              </li>
            
              
              <li class="item-toc ">
                <a href="cache-updates.html" class="sidebar-link ">
                  <span>Updating the Store</span>
                </a>
              </li>
            
          </ul>
        </li>
      
        <li>
          
            <div class="heading-toc">API Reference</div>
          
          <ul class="list-toc">
            
              
              <li class="item-toc ">
                <a href="api.html" class="sidebar-link ">
                  <span>General</span>
                </a>
              </li>
            
              
              <li class="item-toc ">
                <a href="api-graphql.html" class="sidebar-link ">
                  <span>graphql: Container</span>
                </a>
              </li>
            
              
              <li class="item-toc ">
                <a href="api-queries.html" class="sidebar-link ">
                  <span>graphql: Queries</span>
                </a>
              </li>
            
              
              <li class="item-toc  current">
                <a href="" class="sidebar-link  current">
                  <span>graphql: Mutations</span>
                </a>
              </li>
            
              
              <li class="item-toc ">
                <a href="api-server.html" class="sidebar-link ">
                  <span>Server Side Rendering</span>
                </a>
              </li>
            
          </ul>
        </li>
      
        <li>
          
            <div class="heading-toc">Recipes</div>
          
          <ul class="list-toc">
            
              
              <li class="item-toc ">
                <a href="auth.html" class="sidebar-link ">
                  <span>Authentication</span>
                </a>
              </li>
            
              
              <li class="item-toc ">
                <a href="pagination.html" class="sidebar-link ">
                  <span>Pagination</span>
                </a>
              </li>
            
              
              <li class="item-toc ">
                <a href="optimistic-ui.html" class="sidebar-link ">
                  <span>Optimistic UI</span>
                </a>
              </li>
            
              
              <li class="item-toc ">
                <a href="fragments.html" class="sidebar-link ">
                  <span>Using Fragments</span>
                </a>
              </li>
            
              
              <li class="item-toc ">
                <a href="prefetching.html" class="sidebar-link ">
                  <span>Prefetching data</span>
                </a>
              </li>
            
              
              <li class="item-toc ">
                <a href="react-native.html" class="sidebar-link ">
                  <span>Integrating with React Native</span>
                </a>
              </li>
            
              
              <li class="item-toc ">
                <a href="redux.html" class="sidebar-link ">
                  <span>Integrating with Redux</span>
                </a>
              </li>
            
              
              <li class="item-toc ">
                <a href="webpack.html" class="sidebar-link ">
                  <span>Webpack loader</span>
                </a>
              </li>
            
              
              <li class="item-toc ">
                <a href="server-side-rendering.html" class="sidebar-link ">
                  <span>Server Side Rendering</span>
                </a>
              </li>
            
          </ul>
        </li>
      
    </ul>
  </div>
</div>

<div class="content">
  <div class="content-wrapper">
    <div class="header-content">
      <h1 class="title-page">API: graphql container with mutations</h1>
      

      <div class="page-actions">
        <div class="actions-group">
          <a class="btn tertiary small round lowercase" href="https://github.com/apollographqlcn/react-docs-cn/tree/master/source/api-mutations.md" target="_blank"><span class="icon-github"></span> <span>Edit on GitHub</span></a>
          
        </div>
      </div>
    </div>

    <div class="document-formatting">
      <blockquote>
<p>This article is specifically about using mutations with the <code>graphql()</code> higher order component. To see options that apply to all operations, see the <a href="/react/api-graphql.html">general graphql container API docs</a>.</p>
</blockquote>
<p>The operation that you pass into your <code>graphql()</code> function decides how your component will behave. If you pass a mutation into your <code>graphql()</code> function then Apollo will set up a <code>mutate</code> function in your components props that you may call at any time.</p>
<p>Here is an example component that uses a mutation with the <code>graphql()</code> function:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">export</span> <span class="keyword">default</span> graphql(gql<span class="string">`</span></div><div class="line">  mutation TodoCompleteMutation($id: ID!) &#123;</div><div class="line">    completeTodo(id: $id) &#123;</div><div class="line">      id</div><div class="line">      text</div><div class="line">      completed</div><div class="line">    &#125;</div><div class="line">  &#125;</div><div class="line">`)(TodoCompleteButton);</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">TodoCompleteButton</span>(<span class="params">&#123; todoID, mutate &#125;</span>) </span>&#123;</div><div class="line">  <span class="keyword">return</span> (</div><div class="line">    &lt;button onClick=&#123;() =&gt; mutate(&#123; variables: &#123; id: todoID &#125; &#125;)&#125;&gt;</div><div class="line">      Complete</div><div class="line">    &lt;/button&gt;</div><div class="line">  );</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>For a more natural overview of mutations with the <code>graphql()</code> function be sure to read the <a href="mutations.html">Mutations documentation article</a>. For a technical overview of all the features supported by the <code>graphql()</code> function for mutations, continue on.</p>
<h2 id="graphql-mutation-mutate"><code>props.mutate</code></h2>

<p>The higher order component created when you pass a mutation to <code>graphql()</code> will provide your component with a single prop named <code>mutate</code>. Unlike the <code>data</code> prop which you get when you pass a query to <code>graphql()</code>, <code>mutate</code> is a function.</p>
<p>The <code>mutate</code> function will actually execute your mutation using the network interface therefore mutating your data. The <code>mutate</code> function will also then update your cache in ways you define.</p>
<p>To learn more about how mutations work, be sure to check out the <a href="mutations.html">mutations usage documentation</a>.</p>
<p>The <code>mutate</code> function accepts the same options that <a href="#graphql-mutation-options"><code>config.options</code> for mutations</a> accepts, so to make sure to read through the documentation for that to know what you can pass into the <code>mutate</code> function.</p>
<p>The reason the <code>mutate</code> function accepts the same options is that it will use the options from <a href="#graphql-mutation-options"><code>config.options</code></a> <em>by default</em>. When you pass an object into the <code>mutate</code> function you are just overriding what is already in <a href="#graphql-mutation-options"><code>config.options</code></a>.</p>
<p><strong>Example:</strong></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">MyComponent</span>(<span class="params">&#123; mutate &#125;</span>) </span>&#123;</div><div class="line">  <span class="keyword">return</span> (</div><div class="line">    &lt;button onClick=&#123;() =&gt; &#123;</div><div class="line">      mutate(&#123;</div><div class="line">        variables: &#123; foo: 42 &#125;,</div><div class="line">      &#125;);</div><div class="line">    &#125;&#125;&gt;</div><div class="line">      Mutate</div><div class="line">    &lt;/button&gt;</div><div class="line">  );</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="keyword">export</span> <span class="keyword">default</span> graphql(gql<span class="string">`mutation &#123; ... &#125;`</span>)(MyComponent);</div></pre></td></tr></table></figure>
<h2 id="graphql-mutation-options"><code>config.options</code></h2>

<p>An object or function that returns an object of options that are used to configure how the query is fetched and updated.</p>
<p>If <code>config.options</code> is a function then it will take the component’s props as its first argument.</p>
<p>The options available for use in this object depend on the operation type you pass in as the first argument to <code>graphql()</code>. The references below will document which options are availble when your operation is a mutation. To see what other options are available for different operations, see the generic documentation for <a href="#graphql-config-options"><code>config.options</code></a>.</p>
<p>The properties accepted in this options object may also be excepted by the <a href="#graphql-mutation-mutate"><code>props.mutate</code></a> function. Any options passed into the <code>mutate</code> function will take precedence over the options defined in the <code>config</code> object.</p>
<p><strong>Example:</strong></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">export</span> <span class="keyword">default</span> graphql(gql<span class="string">`mutation &#123; ... &#125;`</span>, &#123;</div><div class="line">  <span class="attr">options</span>: &#123;</div><div class="line">    <span class="comment">// Options go here.</span></div><div class="line">  &#125;,</div><div class="line">&#125;)(MyComponent);</div></pre></td></tr></table></figure>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">export</span> <span class="keyword">default</span> graphql(gql<span class="string">`mutation &#123; ... &#125;`</span>, &#123;</div><div class="line">  <span class="attr">options</span>: <span class="function">(<span class="params">props</span>) =&gt;</span> (&#123;</div><div class="line">    <span class="comment">// Options are computed from `props` here.</span></div><div class="line">  &#125;),</div><div class="line">&#125;)(MyComponent);</div></pre></td></tr></table></figure>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">MyComponent</span>(<span class="params">&#123; mutate &#125;</span>) </span>&#123;</div><div class="line">  <span class="keyword">return</span> (</div><div class="line">    &lt;button onClick=&#123;() =&gt; &#123;</div><div class="line">      mutate(&#123;</div><div class="line">        // Options are component from `props` and component state here.</div><div class="line">      &#125;);</div><div class="line">    &#125;&#125;&gt;</div><div class="line">      Mutate</div><div class="line">    &lt;/button&gt;</div><div class="line">  )</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="keyword">export</span> <span class="keyword">default</span> graphql(gql<span class="string">`mutation &#123; ... &#125;`</span>)(MyComponent);</div></pre></td></tr></table></figure>
<h3 id="graphql-mutation-options-variables"><code>options.variables</code></h3>

<p>The variables which will be used to execute the mutation operation. These variables should correspond to the variables that your mutation definition accepts. If you define <code>config.options</code> as a function, or you pass variables into the <a href="#graphql-mutation-mutate"><code>props.mutate</code></a> function then you may compute your variables from props and component state.</p>
<p><strong>Example:</strong></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">export</span> <span class="keyword">default</span> graphql(gql<span class="string">`</span></div><div class="line">  mutation ($foo: String!, $bar: String!) &#123;</div><div class="line">    ...</div><div class="line">  &#125;</div><div class="line">`, &#123;</div><div class="line">  <span class="attr">options</span>: <span class="function">(<span class="params">props</span>) =&gt;</span> (&#123;</div><div class="line">    <span class="attr">variables</span>: &#123;</div><div class="line">      <span class="attr">foo</span>: props.foo,</div><div class="line">      <span class="attr">bar</span>: props.bar,</div><div class="line">    &#125;,</div><div class="line">  &#125;),</div><div class="line">&#125;)(MyComponent);</div></pre></td></tr></table></figure>
<h3 id="graphql-mutation-options-optimisticResponse"><code>options.optimisticResponse</code></h3>

<p>Often when you mutate data it is fairly easy to predict what the response of the mutation will be before asking your server. The optimistic response option allows you to make your mutations feel faster by simulating the result of your mutation in your UI before the mutation actually finishes.</p>
<p>To learn more about the benefits of optimistic data and how to use it be sure to read the recipe on <a href="optimistic-ui.html">Optimistic UI</a>.</p>
<p>This optimistic response will be used with <a href="#graphql-mutation-options-update"><code>options.update</code></a> and <a href="#graphql-mutation-options-updateQueries"><code>options.updateQueries</code></a> to apply an update to your cache which will be rolled back before applying the update from the actual response.</p>
<p><strong>Example:</strong></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">MyComponent</span>(<span class="params">&#123; newText, mutate &#125;</span>) </span>&#123;</div><div class="line">  <span class="keyword">return</span> (</div><div class="line">    &lt;button onClick=&#123;() =&gt; &#123;</div><div class="line">      mutate(&#123;</div><div class="line">        variables: &#123;</div><div class="line">          text: newText,</div><div class="line">        &#125;,</div><div class="line">        // The optimistic response has all of the fields that are included in</div><div class="line">        // the GraphQL mutation document below.</div><div class="line">        optimisticResponse: &#123;</div><div class="line">          createTodo: &#123;</div><div class="line">            id: -1, // A temporary id. The server decides the real id.</div><div class="line">            text: newText,</div><div class="line">            completed: false,</div><div class="line">          &#125;,</div><div class="line">        &#125;,</div><div class="line">      &#125;);</div><div class="line">    &#125;&#125;&gt;</div><div class="line">      Add Todo</div><div class="line">    &lt;/button&gt;</div><div class="line">  );</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="keyword">export</span> <span class="keyword">default</span> graphql(gql<span class="string">`</span></div><div class="line">  mutation ($text: String!) &#123;</div><div class="line">    createTodo(text: $text) &#123;</div><div class="line">      id</div><div class="line">      text</div><div class="line">      completed</div><div class="line">    &#125;</div><div class="line">  &#125;</div><div class="line">`)(MyComponent);</div></pre></td></tr></table></figure>
<h3 id="graphql-mutation-options-update"><code>options.update</code></h3>

<p>This option allows you to update your store based on your mutation’s result. By default Apollo Client will update all of the overlapping nodes in your store. Anything that shares the same id as returned by the <code>dataIdFromObject</code> you defined will be updated with the new fields from your mutation results. However, sometimes this alone is not sufficient. Sometimes you may want to update your cache in a way that is dependent on the data currently in your cache. For these updates you may use an <code>options.update</code> function.</p>
<p><code>options.update</code> takes two arguments. The first is an instance of a <a href="../core/apollo-client-api.html#DataProxy"><code>DataProxy</code></a> object which has some methods which will allow you to interact with the data in your store. The second is the response from your mutation - either the optimistic response, or the actual response returned by your server.</p>
<p>In order to change the data in your store call methods on your <a href="../core/apollo-client-api.html#DataProxy"><code>DataProxy</code></a> instance like <a href="../core/apollo-client-api.html#DataProxy.writeQuery"><code>writeQuery</code></a> and <a href="../core/apollo-client-api.html#DataProxy.writeFragment"><code>writeFragment</code></a>. This will update your cache and reactively re-render any of your GraphQL components which are querying affected data.</p>
<p>To read the data from the store that you are changing, make sure to use methods on your <a href="../core/apollo-client-api.html#DataProxy"><code>DataProxy</code></a> like <a href="../core/apollo-client-api.html#DataProxy.readQuery"><code>readQuery</code></a> and <a href="../core/apollo-client-api.html#DataProxy.readFragment"><code>readFragment</code></a>.</p>
<p>For more information on updating your cache after a mutation with the <code>options.update</code> function make sure to read the <a href="../core/read-and-write.html#updating-the-cache-after-a-mutation">Apollo Client technical documentation on the subject</a>.</p>
<p><strong>Example:</strong></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">const</span> query = gql<span class="string">`&#123; todos &#123; ... &#125; &#125;`</span></div><div class="line"></div><div class="line"><span class="keyword">export</span> <span class="keyword">default</span> graphql(gql<span class="string">`</span></div><div class="line">  mutation ($text: String!) &#123;</div><div class="line">    createTodo(text: $text) &#123; ... &#125;</div><div class="line">  &#125;</div><div class="line">`, &#123;</div><div class="line">  <span class="attr">options</span>: &#123;</div><div class="line">    <span class="attr">update</span>: <span class="function">(<span class="params">proxy, &#123; data: &#123; createTodo &#125; &#125;</span>) =&gt;</span> &#123;</div><div class="line">      <span class="keyword">const</span> data = proxy.readQuery(&#123; query &#125;);</div><div class="line">      data.todos.push(createTodo);</div><div class="line">      proxy.writeQuery(&#123; query, data &#125;);</div><div class="line">    &#125;,</div><div class="line">  &#125;,</div><div class="line">&#125;)(MyComponent);</div></pre></td></tr></table></figure>
<h3 id="graphql-mutation-options-refetchQueries"><code>options.refetchQueries</code></h3>

<p>Sometimes when you make a mutation you also want to update the data in your queries so that your users may see an up-to-date user interface. There are more fine-grained ways to update the data in your cache which include <a href="#graphql-mutation-options-updateQueries"><code>options.updateQueries</code></a>, and <a href="#graphql-mutation-options-update"><code>options.update</code></a>. However, you can update the data in your cache more reliably at the cost of efficiency by using <code>options.refetchQueries</code>.</p>
<p><code>options.refetchQueries</code> will execute one or more queries using your network interface and will then normalize the results of those queries into your cache. Allowing you to potentially refetch queries you had fetched before, or fetch brand new queries.</p>
<p><code>options.refetchQueries</code> is an array of either strings or objects.</p>
<p>If <code>options.refetchQueries</code> is an array of strings then Apollo Client will look for any queries with the same names as the provided strings and will refetch those queries with their current variables. So for example if you have a GraphQL query component with a query named <code>Comments</code> (the query may look like: <code>query Comments { ... }</code>), and you pass an array of strings containing <code>Comments</code> to <code>options.refetchQueries</code> then the <code>Comments</code> query will be re-executed and when it resolves the latest data will be reflected in your UI.</p>
<p>If <code>options.refetchQueries</code> is an array of objects then the objects must have two properties:</p>
<ul>
<li><code>query</code>: Query is a required property that accepts a GraphQL query created with <code>graphql-tag</code>’s <code>gql</code> template string tag. It should contain a single GraphQL query operation that will be executed once the mutation has completed.</li>
<li><code>[variables]</code>: Is an optional object of variables that is required when <code>query</code> accepts some variables.</li>
</ul>
<p>If an array of objects with this shape is specified then Apollo Client will refetch these queries with their variables.</p>
<p><strong>Example:</strong></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">export</span> <span class="keyword">default</span> graphql(gql<span class="string">`mutation &#123; ... &#125;`</span>, &#123;</div><div class="line">  <span class="attr">options</span>: &#123;</div><div class="line">    <span class="attr">refetchQueries</span>: [</div><div class="line">      <span class="string">'CommentList'</span>,</div><div class="line">      <span class="string">'PostList'</span>,</div><div class="line">    ],</div><div class="line">  &#125;,</div><div class="line">&#125;)(MyComponent);</div></pre></td></tr></table></figure>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">import</span> &#123; COMMENT_LIST_QUERY &#125; <span class="keyword">from</span> <span class="string">'../components/CommentList'</span>;</div><div class="line"></div><div class="line"><span class="keyword">export</span> <span class="keyword">default</span> graphql(gql<span class="string">`mutation &#123; ... &#125;`</span>, &#123;</div><div class="line">  <span class="attr">options</span>: <span class="function">(<span class="params">props</span>) =&gt;</span> (&#123;</div><div class="line">    <span class="attr">refetchQueries</span>: [</div><div class="line">      &#123;</div><div class="line">        <span class="attr">query</span>: COMMENT_LIST_QUERY,</div><div class="line">      &#125;,</div><div class="line">      &#123;</div><div class="line">        <span class="attr">query</span>: gql<span class="string">`</span></div><div class="line">          query ($id: ID!) &#123;</div><div class="line">            post(id: $id) &#123;</div><div class="line">              commentCount</div><div class="line">            &#125;</div><div class="line">          &#125;</div><div class="line">        `,</div><div class="line">        <span class="attr">variables</span>: &#123;</div><div class="line">          <span class="attr">id</span>: props.postID,</div><div class="line">        &#125;,</div><div class="line">      &#125;,</div><div class="line">    ],</div><div class="line">  &#125;),</div><div class="line">&#125;)(MyComponent);</div></pre></td></tr></table></figure>
<h3 id="graphql-mutation-options-updateQueries"><code>options.updateQueries</code></h3>

<p><strong>Note: We recommend using <a href="#graphql-mutation-options-update">update</a> instead of <code>updateQueries</code>.</strong></p>
<p>This option allows you to update your store based on your mutation’s result. By default Apollo Client will update all of the overlapping nodes in your store. Anything that shares the same id as returned by the <code>dataIdFromObject</code> you defined will be updated with the new fields from your mutation results. However, sometimes this alone is not sufficient. Sometimes you may want to update your cache in a way that is dependent on the data currently in your cache. For these updates you may use an <code>options.updateQueries</code> function.</p>
<p><code>options.updateQueries</code> takes an object where query names are the keys and reducer functions are the values. If you are familiar with Redux, defining your <code>options.updateQueries</code> reducers is very similar to defining your Redux reducers. The object looks something like this:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">&#123;</div><div class="line">  <span class="attr">Comments</span>: <span class="function">(<span class="params">previousData, &#123; mutationResult, queryVariables &#125;</span>) =&gt;</span> nextData,</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>Make sure that the key of your <code>options.updateQueries</code> object corresponds to an actual query that you have made somewhere else in your app. The query name will be the name you put after specifying the <code>query</code> operation type. So for example in the following query:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">query Comments &#123;</div><div class="line">  entry(id: 5) &#123;</div><div class="line">    comments &#123;</div><div class="line">      ...</div><div class="line">    &#125;</div><div class="line">  &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>The query name would be <code>Comments</code>. If you have not executed a GraphQL query with the name of <code>Comments</code> before somewhere in your application, then the reducer function will never be run by Apollo and the key/value pair in <code>options.updateQueries</code> will be ignored.</p>
<p>The first argument to the function you provide as the value for your object will be the previous data for your query. So if your key is <code>Comments</code> then the first argument will be the last data object that was returned for your <code>Comments</code> query, or the current object that is being rendered by any component using the <code>Comments</code> query.</p>
<p>The second argument to your function value will be an object with three properties:</p>
<ul>
<li><code>mutationResult</code>: The <code>mutationResult</code> property will represent the result of your mutation after hitting the server. If you provided an <a href="#graphql-mutation-options-optimisticResponse"><code>options.optimisticResponse</code></a> then <code>mutationResult</code> may be that object.</li>
<li><code>queryVariables</code>: The last set of variables that the query was executed with. This is helpful because when you specify the query name it will only update the data in the store for your current variable set.</li>
<li><code>queryName</code>: This is the name of the query you are updating. It is the same name as the key you provided to <code>options.updateQueries</code>.</li>
</ul>
<p>The return value of your <code>options.updateQueries</code> functions <em>must</em> have the same shape as your first <code>previousData</code> argument. However, you <em>must not</em> mutate the <code>previousData</code> object. Instead you must create a new object with your changes. Just like in a Redux reducer.</p>
<p>To learn more about <code>options.updateQueries</code> read our usage documentation on <a href="cache-updates.html#updateQueries">controlling the store with <code>updateQueries</code></a>.</p>
<p><strong>Example:</strong></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">export</span> <span class="keyword">default</span> graphql(gql<span class="string">`</span></div><div class="line">  mutation ($text: String!) &#123;</div><div class="line">    submitComment(text: $text) &#123; ... &#125;</div><div class="line">  &#125;</div><div class="line">`, &#123;</div><div class="line">  <span class="attr">options</span>: &#123;</div><div class="line">    <span class="attr">updateQueries</span>: &#123;</div><div class="line">      <span class="attr">Comments</span>: <span class="function">(<span class="params">previousData, &#123; mutationResult &#125;</span>) =&gt;</span> &#123;</div><div class="line">        <span class="keyword">const</span> newComment = mutationResult.data.submitComment;</div><div class="line">        <span class="comment">// Note how we return a new copy of `previousData` instead of mutating</span></div><div class="line">        <span class="comment">// it. This is just like a Redux reducer!</span></div><div class="line">        <span class="keyword">return</span> &#123;</div><div class="line">          ...previousData,</div><div class="line">          <span class="attr">entry</span>: &#123;</div><div class="line">            ...previousData.entry,</div><div class="line">            <span class="attr">comments</span>: [newComment, ...previousData.entry.comments],</div><div class="line">          &#125;,</div><div class="line">        &#125;;</div><div class="line">      &#125;,</div><div class="line">    &#125;,</div><div class="line">  &#125;,</div><div class="line">&#125;)(MyComponent);</div></pre></td></tr></table></figure>

    </div>
  </div>

  <div class="pagination">
    <div class="content-wrapper">
      
      
        <a class="link primary prev"
          href="api-queries.html">
          <span class="icon-arrow-left-alt"></span>
          <span class="subtitle-pagination">Previous</span>
          API: graphql container with queries
        </a>
      
      
        <a class="link primary next"
          href="api-server.html">
          <span class="subtitle-pagination">Next</span>
          API: Server Side Rendering
          <span class="icon-arrow-right-alt"></span>
        </a>
      
    </div>
  </div>

  <div class="github">
    <a class="link tertiary " href="https://github.com/apollographqlcn/react-docs-cn/tree/master/source/api-mutations.md" target="_blank">
      <span class="icon-github"></span>Edit on GitHub</a>
  </div>

  
</div>

    <script src="/script/smooth-scroll.min.js"></script>
    <script src="/script/main.js"></script>
    <script type="text/javascript" src="//cdn.jsdelivr.net/docsearch.js/1/docsearch.min.js"></script>
    <script type="text/javascript" src="//cdn.jsdelivr.net/fastclick/1.0.6/fastclick.min.js"></script>

    <script>
      // nectar ninja
      (function(){
        var handle = '@meteorjs';
        var a = document.createElement('script');
        var m = document.getElementsByTagName('script')[0];
        a.async = 1;
        a.src = 'https://nectar.ninja/api/v1/' + handle.slice(1);
        m.parentNode.insertBefore(a, m);
      })();

     

      
        (function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
        new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
        j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
        'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
        })(window,document,'script','dataLayer','GTM-PNFDVBB');
      

      
        // Segment Tracking
        !function(){var analytics=window.analytics=window.analytics||[];if(!analytics.initialize)if(analytics.invoked)window.console&&console.error&&console.error("Segment snippet included twice.");else{analytics.invoked=!0;analytics.methods=["trackSubmit","trackClick","trackLink","trackForm","pageview","identify","reset","group","track","ready","alias","page","once","off","on"];analytics.factory=function(t){return function(){var e=Array.prototype.slice.call(arguments);e.unshift(t);analytics.push(e);return analytics}};for(var t=0;t<analytics.methods.length;t++){var e=analytics.methods[t];analytics[e]=analytics.factory(e)}analytics.load=function(t){var e=document.createElement("script");e.type="text/javascript";e.async=!0;e.src=("https:"===document.location.protocol?"https://":"http://")+"cdn.segment.com/analytics.js/v1/"+t+"/analytics.min.js";var n=document.getElementsByTagName("script")[0];n.parentNode.insertBefore(e,n)};analytics.SNIPPET_VERSION="3.1.0";
        analytics.load("wgrIo8Bul0Ujl8USETG3DB6hONdy4kTg");
        analytics.page()
        }}();
      

      // search box
      

        ['desktop', 'mobile'].forEach(function(type) {
          var search = docsearch({
            apiKey: '768e823959d35bbd51e4b2439be13fb7',
            indexName: 'apollodata',
            inputSelector: '#' + type + '-search-input',
            autocompleteOptions: {
              dropdownMenuContainer: '.wrapper-' + type + '-search-results',
              debug: true
            },
            algoliaOptions: {
              hitsPerPage: 20
            }
          }).autocomplete;

          var sidebar = document.querySelector('.sidebar-content');
          search.on('autocomplete:opened', function() {
            sidebar.classList.add('searching');
          });
          search.on('autocomplete:closed', function() {
            sidebar.classList.remove('searching');
          });
          search.on('autocomplete:updated', function() {
            if (search.val() === '') {
              search.autocomplete.close();
            }
          });
        });
      

      
    </script>
  </body>
</html>
