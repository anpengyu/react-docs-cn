<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">

    <!-- Basic -->
    <title>Server Side Rendering | Apollo React Docs</title>
    <meta name="description" content="">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="shortcut icon" type="image/png" href="images/favicon.png" sizes="16x16 32x32 64x64">

    <!-- Social -->
    <meta property="og:type" content="article">
    <meta property="og:url" content="https://apollographqlcn.github.io/react-docs-cn">
    <meta property="og:title" content="Server Side Rendering | Apollo React Docs">
    <meta property="og:description" content="">
    <meta property="og:image" content="">
    <meta name="twitter:card" content="summary_image_large">
    <meta name="twitter:site" content="@apollographqlcn">
    <meta name="twitter:title" content="Server Side Rendering | Apollo React Docs">
    <meta name="twitter:description" content="">
    <meta name="twitter:image" content="">

    <!-- Misc -->
    <meta name="google-site-verification" content="" />
    <link href='https://fonts.googleapis.com/css?family=Source+Sans+Pro:400,300,200,300italic,400italic' rel='stylesheet' type='text/css'>
    <link rel="stylesheet" href="/react-docs-cn/style/style.css">
  </head>
  <body class="">
    

<div class="nav dark">
  <div class="nav-group">
    <div class="nav-item show-mobile">
      <span class="js-sidebar-toggle ">
        <span class="icon-menu"></span>
      </span>
    </div>
    <div class="nav-item">
      
      <a class="logo-wrapper" href="http://dev.apollodata.com/" title="Apollo Developers"  >
        <img src="images/logo-apollo-space-left.svg" alt="Apollo" class="logo"/><img src="images/logo-apollo-subbrands-developers-space.svg" class="logo-subbrand" alt="Developers"/>
      </a>
    </div>
  </div>

  <div class="nav-group right">
    
      
      <div class="nav-item show-desktop false ">
        <a class="link" href="http://dev.apollodata.com/react"  >
          <span>React</span>
        </a>
      </div>
    
      
      <div class="nav-item show-desktop false ">
        <a class="link" href="http://dev.apollodata.com/angular2"  >
          <span>Angular</span>
        </a>
      </div>
    
      
      <div class="nav-item show-desktop false ">
        <a class="link" href="http://dev.apollodata.com/ios"  >
          <span>iOS</span>
        </a>
      </div>
    
      
      <div class="nav-item show-desktop false ">
        <a class="link" href="http://dev.apollodata.com/android"  >
          <span>Android</span>
        </a>
      </div>
    
      
      <div class="nav-item show-desktop false ">
        <a class="link" href="http://dev.apollodata.com/core"  >
          <span>Vanilla JS</span>
        </a>
      </div>
    
      
      <div class="nav-item show-desktop false separator">
        <a class="link" href="http://dev.apollodata.com/tools"  >
          <span>Server</span>
        </a>
      </div>
    
      
      <div class="nav-item show-desktop false ">
        <a class="link" href="https://medium.com/apollo-stack" target=_new >
          <span>Blog</span>
        </a>
      </div>
    
      
      <div class="nav-item show-desktop false ">
        <a class="link" href="http://dev.apollodata.com/community"  >
          <span>Community</span>
        </a>
      </div>
    
  </div>
</div>

<div class="sidebar">
  <div class="panel">
    <div class="panel-item">
      <a class="" href="http:/dev.apollodata.com/" title="Apollo"  >
        <span>Apollo Developers</span>
      </a>
    </div>
    
      <div class="panel-item "">
        <a class="" href="http://dev.apollodata.com/react"  >
          <span>React</span>
        </a>
      </div>
    
      <div class="panel-item "">
        <a class="" href="http://dev.apollodata.com/angular2"  >
          <span>Angular</span>
        </a>
      </div>
    
      <div class="panel-item "">
        <a class="" href="http://dev.apollodata.com/ios"  >
          <span>iOS</span>
        </a>
      </div>
    
      <div class="panel-item "">
        <a class="" href="http://dev.apollodata.com/android"  >
          <span>Android</span>
        </a>
      </div>
    
      <div class="panel-item "">
        <a class="" href="http://dev.apollodata.com/core"  >
          <span>Vanilla JS</span>
        </a>
      </div>
    
      <div class="panel-item "">
        <a class="" href="http://dev.apollodata.com/tools"  >
          <span>Server</span>
        </a>
      </div>
    
      <div class="panel-item "">
        <a class="" href="https://medium.com/apollo-stack" target=_new >
          <span>Blog</span>
        </a>
      </div>
    
      <div class="panel-item "">
        <a class="" href="http://dev.apollodata.com/community"  >
          <span>Community</span>
        </a>
      </div>
    
  </div>

  <div class="sidebar-content">
    <div class="topcap">
      <span class="title-sidebar">Apollo React Docs</span>
      
    </div>

    
    <div class="wrapper-search">
      <div class="input-symbol small round">
        <input type="text" placeholder="Search React Guide" id="desktop-search-input" />
        <span class="icon-search"></span>
      </div>
      <div class="wrapper-desktop-search-results"></div>
    </div>

    

    <ul class="toc">
      
        <li>
          
          <ul class="list-toc">
            
              
              <li class="item-toc ">
                <a href="index.html" class="sidebar-link ">
                  <span>Introduction</span>
                </a>
              </li>
            
              
              <li class="item-toc ">
                <a href="initialization.html" class="sidebar-link ">
                  <span>Setup and options</span>
                </a>
              </li>
            
              
              <li class="item-toc ">
                <a href="simple-example.html" class="sidebar-link ">
                  <span>Small Example: Snack</span>
                </a>
              </li>
            
              
              <li class="item-toc ">
                <a href="example-schema.html" class="sidebar-link ">
                  <span>Full Example: GitHunt</span>
                </a>
              </li>
            
              
              <li class="item-toc ">
                <a href="migration.html" class="sidebar-link ">
                  <span>Migrating to 1.0</span>
                </a>
              </li>
            
          </ul>
        </li>
      
        <li>
          
            <div class="heading-toc">Usage</div>
          
          <ul class="list-toc">
            
              
              <li class="item-toc ">
                <a href="queries.html" class="sidebar-link ">
                  <span>Queries</span>
                </a>
              </li>
            
              
              <li class="item-toc ">
                <a href="mutations.html" class="sidebar-link ">
                  <span>Mutations</span>
                </a>
              </li>
            
              
              <li class="item-toc ">
                <a href="subscriptions.html" class="sidebar-link ">
                  <span>Subscriptions</span>
                </a>
              </li>
            
              
              <li class="item-toc ">
                <a href="receiving-updates.html" class="sidebar-link ">
                  <span>Syncing with the Server</span>
                </a>
              </li>
            
              
              <li class="item-toc ">
                <a href="cache-updates.html" class="sidebar-link ">
                  <span>Updating the Store</span>
                </a>
              </li>
            
          </ul>
        </li>
      
        <li>
          
            <div class="heading-toc">API Reference</div>
          
          <ul class="list-toc">
            
              
              <li class="item-toc ">
                <a href="api.html" class="sidebar-link ">
                  <span>General</span>
                </a>
              </li>
            
              
              <li class="item-toc ">
                <a href="api-graphql.html" class="sidebar-link ">
                  <span>graphql: Container</span>
                </a>
              </li>
            
              
              <li class="item-toc ">
                <a href="api-queries.html" class="sidebar-link ">
                  <span>graphql: Queries</span>
                </a>
              </li>
            
              
              <li class="item-toc ">
                <a href="api-mutations.html" class="sidebar-link ">
                  <span>graphql: Mutations</span>
                </a>
              </li>
            
              
              <li class="item-toc ">
                <a href="api-server.html" class="sidebar-link ">
                  <span>Server Side Rendering</span>
                </a>
              </li>
            
          </ul>
        </li>
      
        <li>
          
            <div class="heading-toc">Recipes</div>
          
          <ul class="list-toc">
            
              
              <li class="item-toc ">
                <a href="auth.html" class="sidebar-link ">
                  <span>Authentication</span>
                </a>
              </li>
            
              
              <li class="item-toc ">
                <a href="pagination.html" class="sidebar-link ">
                  <span>Pagination</span>
                </a>
              </li>
            
              
              <li class="item-toc ">
                <a href="optimistic-ui.html" class="sidebar-link ">
                  <span>Optimistic UI</span>
                </a>
              </li>
            
              
              <li class="item-toc ">
                <a href="fragments.html" class="sidebar-link ">
                  <span>Using Fragments</span>
                </a>
              </li>
            
              
              <li class="item-toc ">
                <a href="prefetching.html" class="sidebar-link ">
                  <span>Prefetching data</span>
                </a>
              </li>
            
              
              <li class="item-toc ">
                <a href="react-native.html" class="sidebar-link ">
                  <span>Integrating with React Native</span>
                </a>
              </li>
            
              
              <li class="item-toc ">
                <a href="redux.html" class="sidebar-link ">
                  <span>Integrating with Redux</span>
                </a>
              </li>
            
              
              <li class="item-toc ">
                <a href="webpack.html" class="sidebar-link ">
                  <span>Webpack loader</span>
                </a>
              </li>
            
              
              <li class="item-toc  current">
                <a href="" class="sidebar-link  current">
                  <span>Server Side Rendering</span>
                </a>
              </li>
            
          </ul>
        </li>
      
    </ul>
  </div>
</div>

<div class="content">
  <div class="content-wrapper">
    <div class="header-content">
      <h1 class="title-page">Server Side Rendering</h1>
      

      <div class="page-actions">
        <div class="actions-group">
          <a class="btn tertiary small round lowercase" href="https://github.com/apollographqlcn/react-docs-cn/tree/master/source/server-side-rendering.md" target="_blank"><span class="icon-github"></span> <span>Edit on GitHub</span></a>
          
        </div>
      </div>
    </div>

    <div class="document-formatting">
      <p>Apollo provides two techniques to allow your applications to load quickly, avoiding unnecessary delays to users:</p>
<ul>
<li>Store rehydration, which allows your initial set of queries to return data immediately without a server roundtrip.</li>
<li>Server side rendering, which renders the initial HTML view on the server before sending it to the client.</li>
</ul>
<p>You can use one or both of these techniques to provide a better user experience.</p>
<h2 id="store-rehydration">Store rehydration</h2>

<p>For applications that can perform some queries on the server prior to rendering the UI on the client, Apollo allows for setting the initial state of data. This is sometimes called rehydration, since the data is “dehydrated” when it is serialized and included in the initial HTML payload.</p>
<p>For example, a typical approach is to include a script tag that looks something like:</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="javascript"></span></div><div class="line">  <span class="comment">// `initialState` should have the shape of the Apollo store</span></div><div class="line">  <span class="comment">// state. Make sure to include only the data though. E.g.:</span></div><div class="line">  <span class="comment">// const initialState = &#123;[client.reduxRootKey]: &#123;</span></div><div class="line">  <span class="comment">//   data: client.store.getState()[client.reduxRootKey].data</span></div><div class="line">  <span class="comment">// &#125;&#125;;</span></div><div class="line">  <span class="built_in">window</span>.__APOLLO_STATE__ = initialState;</div><div class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></div></pre></td></tr></table></figure>
<p>You can then rehydrate the client using the initial state passed from the server:<br><figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">const</span> client = <span class="keyword">new</span> ApolloClient(&#123;</div><div class="line">  <span class="attr">initialState</span>: <span class="built_in">window</span>.__APOLLO_STATE__,</div><div class="line">&#125;);</div></pre></td></tr></table></figure></p>
<p>We’ll see below how you can generate both the HTML and the Apollo store’s state using Node and <code>react-apollo</code>‘s server rendering functions. However if you are rendering HTML via some other means, you will have to generate the state manually.</p>
<p>If you are using <a href="redux.html">Redux</a> externally to Apollo, and already have store rehydration, you should pass the store state into the <a href="http://redux.js.org/docs/basics/Store.html" target="_blank" rel="external"><code>Store</code> constructor</a>.</p>
<p>Then, when the client runs the first set of queries, the data will be returned instantly because it is already in the store!</p>
<p>If you are using <a href="cache-updates.html#forceFetch"><code>forceFetch</code></a> on some of the initial queries, you can pass the <code>ssrForceFetchDelay</code> option to skip force fetching during initialization, so that even those queries run using the cache:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">const</span> client = <span class="keyword">new</span> ApolloClient(&#123;</div><div class="line">  <span class="attr">initialState</span>: <span class="built_in">window</span>.__APOLLO_STATE__,</div><div class="line">  <span class="attr">ssrForceFetchDelay</span>: <span class="number">100</span>,</div><div class="line">&#125;);</div></pre></td></tr></table></figure>
<h2 id="server-rendering">Server-side rendering</h2>

<p>You can render your entire React-based Apollo application on a Node server using rendering functions built into <code>react-apollo</code>. These functions take care of the job of fetching all queries that are required to rendering your component tree. Typically you would use these functions from within a HTTP server such as <a href="https://expressjs.com" target="_blank" rel="external">Express</a>.</p>
<p>No changes are required to client queries to support this, so your Apollo-based React UI should support SSR out of the box.</p>
<h3 id="server-initialization">Server initialization</h3>

<p>In order to render your application on the server, you need to handle a HTTP request (using a server like Express, and a server-capable Router like React-Router), and then render your application to a string to pass back on the response.</p>
<p>We’ll see how to take your component tree and turn it into a string in the next section, but you’ll need to be a little careful in how you construct your Apollo Client instance on the server to ensure everything works there as well:</p>
<ol>
<li><p>When <a href="initialization.html">creating an Apollo Client instance</a> on the server, you’ll need to set up you network interface to connect to the API server correctly. This might look different to how you do it on the client, since you’ll probably have to use an absolute URL to the server if you were using a relative URL on the client.</p>
</li>
<li><p>Since you only want to fetch each query result once, pass the <code>ssrMode: true</code> option to the Apollo Client constructor to avoid repeated force-fetching.</p>
</li>
<li><p>You need to ensure that you create a new client or store instance for each request, rather than re-using the same client for multiple requests. Otherwise the UI will be getting stale data and you’ll have problems with <a href="auth.html">authentication</a>.</p>
</li>
</ol>
<p>Once you put that all together, you’ll end up with initialization code that looks like this:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">import</span> &#123; ApolloClient, createNetworkInterface, ApolloProvider &#125; <span class="keyword">from</span> <span class="string">'react-apollo'</span>;</div><div class="line"><span class="keyword">import</span> Express <span class="keyword">from</span> <span class="string">'express'</span>;</div><div class="line"><span class="keyword">import</span> &#123; match, RouterContext &#125; <span class="keyword">from</span> <span class="string">'react-router'</span>;</div><div class="line"></div><div class="line"><span class="comment">// A Routes file is a good shared entry-point between client and server</span></div><div class="line"><span class="keyword">import</span> routes <span class="keyword">from</span> <span class="string">'./routes'</span>;</div><div class="line"></div><div class="line"><span class="comment">// Note you don't have to use any particular http server, but</span></div><div class="line"><span class="comment">// we're using Express in this example</span></div><div class="line"><span class="keyword">const</span> app = <span class="keyword">new</span> Express();</div><div class="line">app.use(<span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</div><div class="line"></div><div class="line">  <span class="comment">// This example uses React Router, although it should work equally well with other</span></div><div class="line">  <span class="comment">// routers that support SSR</span></div><div class="line">  match(&#123; routes, <span class="attr">location</span>: req.originalUrl &#125;, (error, redirectLocation, renderProps) =&gt; &#123;</div><div class="line"></div><div class="line">    <span class="keyword">const</span> client = <span class="keyword">new</span> ApolloClient(&#123;</div><div class="line">      <span class="attr">ssrMode</span>: <span class="literal">true</span>,</div><div class="line">      <span class="comment">// Remember that this is the interface the SSR server will use to connect to the</span></div><div class="line">      <span class="comment">// API server, so we need to ensure it isn't firewalled, etc</span></div><div class="line">      networkInterface: createNetworkInterface(&#123;</div><div class="line">        <span class="attr">uri</span>: <span class="string">'http://localhost:3010'</span>,</div><div class="line">        <span class="attr">opts</span>: &#123;</div><div class="line">          <span class="attr">credentials</span>: <span class="string">'same-origin'</span>,</div><div class="line">          <span class="comment">// transfer request headers to networkInterface so that they're accessible to proxy server</span></div><div class="line">          <span class="comment">// Addresses this issue: https://github.com/matthew-andrews/isomorphic-fetch/issues/83</span></div><div class="line">          headers: req.headers,</div><div class="line">        &#125;,</div><div class="line">      &#125;),</div><div class="line">    &#125;);</div><div class="line"></div><div class="line">    <span class="keyword">const</span> app = (</div><div class="line">      <span class="xml"><span class="tag">&lt;<span class="name">ApolloProvider</span> <span class="attr">client</span>=<span class="string">&#123;client&#125;</span>&gt;</span></span></div><div class="line">        <span class="tag">&lt;<span class="name">RouterContext</span> &#123;<span class="attr">...renderProps</span>&#125; /&gt;</span></div><div class="line">      <span class="tag">&lt;/<span class="name">ApolloProvider</span>&gt;</span></div><div class="line">    );</div><div class="line"></div><div class="line">    // rendering code (see below)</div><div class="line">  &#125;);</div><div class="line">&#125;);</div><div class="line"></div><div class="line">app.listen(basePort, () =&gt; console.log( // eslint-disable-line no-console</div><div class="line">  `App Server is now running on http://localhost:$&#123;basePort&#125;`</div><div class="line">));</div></pre></td></tr></table></figure>
<p>You can check out the <a href="https://github.com/apollographql/GitHunt-React/blob/master/ui/server.js" target="_blank" rel="external">GitHunt app’s <code>ui/server.js</code></a> for a complete working example.</p>
<p>Next we’ll see what that rendering code actually does.</p>
<h3 id="getDataFromTree">Using <code>getDataFromTree</code></h3>

<p>The <code>getDataFromTree</code> function takes your React tree, determines which queries are needed to render them, and then fetches them all. It does this recursively down the whole tree if you have nested queries. It returns a promise which resolves when the data is ready in your Apollo Client store.</p>
<p>At the point that the promise resolves, your Apollo Client store will be completely initialized, which should mean your app will now render instantly (since all queries are prefetched) and you can return the stringified results in the response:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">import</span> &#123; getDataFromTree &#125; <span class="keyword">from</span> <span class="string">"react-apollo"</span></div><div class="line"></div><div class="line"><span class="keyword">const</span> client = <span class="keyword">new</span> ApolloClient(....);</div><div class="line"></div><div class="line"><span class="comment">// during request (see above)</span></div><div class="line">getDataFromTree(app).then(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</div><div class="line">  <span class="comment">// We are ready to render for real</span></div><div class="line">  <span class="keyword">const</span> content = ReactDOM.renderToString(app);</div><div class="line">  <span class="keyword">const</span> initialState = &#123;[client.reduxRootKey]: client.getInitialState()  &#125;;</div><div class="line"></div><div class="line">  <span class="keyword">const</span> html = <span class="xml"><span class="tag">&lt;<span class="name">Html</span> <span class="attr">content</span>=<span class="string">&#123;content&#125;</span> <span class="attr">state</span>=<span class="string">&#123;initialState&#125;</span> /&gt;</span>;</span></div><div class="line"></div><div class="line">  res.status(200);</div><div class="line">  res.send(`<span class="meta">&lt;!doctype html&gt;</span>\n$&#123;ReactDOM.renderToStaticMarkup(html)&#125;`);</div><div class="line">  res.end();</div><div class="line">&#125;);</div></pre></td></tr></table></figure>
<p>Your markup in this case can look something like:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">Html</span>(<span class="params">&#123; content, state &#125;</span>) </span>&#123;</div><div class="line">  <span class="keyword">return</span> (</div><div class="line">    &lt;html&gt;</div><div class="line">      &lt;body&gt;</div><div class="line">        &lt;div id="content" dangerouslySetInnerHTML=&#123;&#123; __html: content &#125;&#125; /&gt;</div><div class="line">        &lt;script dangerouslySetInnerHTML=&#123;&#123;</div><div class="line">          __html: `window.__APOLLO_STATE__=$&#123;JSON.stringify(state).replace(/&lt;/g, '\\u003c')&#125;;`,</div><div class="line">        &#125;&#125; /&gt;</div><div class="line">      &lt;/body&gt;</div><div class="line">    &lt;/html&gt;</div><div class="line">  );</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h3 id="local-queries">Avoiding the network for local queries</h3>

<p>If your GraphQL endpoint is on the same server that you’re rendering from, you may want to avoid using the network when making your SSR queries. In particular, if localhost is firewalled on your production environment (eg. Heroku), making network requests for these queries will not work. One solution to this problem is the <a href="https://github.com/af/apollo-local-query" target="_blank" rel="external">apollo-local-query</a> module, which lets you create a <code>networkInterface</code> for apollo that doesn’t actually use the network.</p>
<h3 id="skip-for-ssr">Skipping queries for SSR</h3>

<p>If you want to intentionally skip a query during SSR, you can pass <code>ssr: false</code> in the query options. Typically, this will mean the component will get rendered in its loading state on the server. For example:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">const</span> withClientOnlyUser = graphql(GET_USER_WITH_ID, &#123;</div><div class="line">  <span class="attr">options</span>: &#123; <span class="attr">ssr</span>: <span class="literal">false</span> &#125;, <span class="comment">// won't be called during SSR</span></div><div class="line">&#125;);</div></pre></td></tr></table></figure>
<h3 id="renderToStringWithData">Using <code>renderToStringWithData</code></h3>

<p>The <code>renderToStringWithData</code> function simplifies the above and simply returns the content string  that you need to render. So it reduces the number of steps slightly:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// server application code (integrated usage)</span></div><div class="line"><span class="keyword">import</span> &#123; renderToStringWithData &#125; <span class="keyword">from</span> <span class="string">"react-apollo"</span></div><div class="line"></div><div class="line"><span class="keyword">const</span> client = <span class="keyword">new</span> ApolloClient(....);</div><div class="line"></div><div class="line"><span class="comment">// during request</span></div><div class="line">renderToStringWithData(app).then(<span class="function">(<span class="params">content</span>) =&gt;</span> &#123;</div><div class="line">  <span class="keyword">const</span> initialState = &#123;[client.reduxRootKey]: client.getInitialState() &#125;;</div><div class="line">  <span class="keyword">const</span> html = <span class="xml"><span class="tag">&lt;<span class="name">Html</span> <span class="attr">content</span>=<span class="string">&#123;content&#125;</span> <span class="attr">state</span>=<span class="string">&#123;initialState&#125;</span> /&gt;</span>;</span></div><div class="line"></div><div class="line">  res.status(200);</div><div class="line">  res.send(`<span class="meta">&lt;!doctype html&gt;</span>\n$&#123;ReactDOM.renderToStaticMarkup(html)&#125;`);</div><div class="line">  res.end();</div><div class="line">&#125;);</div></pre></td></tr></table></figure>

    </div>
  </div>

  <div class="pagination">
    <div class="content-wrapper">
      
      
        <a class="link primary prev"
          href="webpack.html">
          <span class="icon-arrow-left-alt"></span>
          <span class="subtitle-pagination">Previous</span>
          Webpack loader
        </a>
      
      
    </div>
  </div>

  <div class="github">
    <a class="link tertiary " href="https://github.com/apollographqlcn/react-docs-cn/tree/master/source/server-side-rendering.md" target="_blank">
      <span class="icon-github"></span>Edit on GitHub</a>
  </div>

  
</div>

    <script src="/react-docs-cn/script/smooth-scroll.min.js"></script>
    <script src="/react-docs-cn/script/main.js"></script>
    <script type="text/javascript" src="//cdn.jsdelivr.net/docsearch.js/1/docsearch.min.js"></script>
    <script type="text/javascript" src="//cdn.jsdelivr.net/fastclick/1.0.6/fastclick.min.js"></script>

    <script>
      // nectar ninja
      (function(){
        var handle = '@meteorjs';
        var a = document.createElement('script');
        var m = document.getElementsByTagName('script')[0];
        a.async = 1;
        a.src = 'https://nectar.ninja/api/v1/' + handle.slice(1);
        m.parentNode.insertBefore(a, m);
      })();

     

      
        (function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
        new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
        j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
        'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
        })(window,document,'script','dataLayer','GTM-PNFDVBB');
      

      
        // Segment Tracking
        !function(){var analytics=window.analytics=window.analytics||[];if(!analytics.initialize)if(analytics.invoked)window.console&&console.error&&console.error("Segment snippet included twice.");else{analytics.invoked=!0;analytics.methods=["trackSubmit","trackClick","trackLink","trackForm","pageview","identify","reset","group","track","ready","alias","page","once","off","on"];analytics.factory=function(t){return function(){var e=Array.prototype.slice.call(arguments);e.unshift(t);analytics.push(e);return analytics}};for(var t=0;t<analytics.methods.length;t++){var e=analytics.methods[t];analytics[e]=analytics.factory(e)}analytics.load=function(t){var e=document.createElement("script");e.type="text/javascript";e.async=!0;e.src=("https:"===document.location.protocol?"https://":"http://")+"cdn.segment.com/analytics.js/v1/"+t+"/analytics.min.js";var n=document.getElementsByTagName("script")[0];n.parentNode.insertBefore(e,n)};analytics.SNIPPET_VERSION="3.1.0";
        analytics.load("wgrIo8Bul0Ujl8USETG3DB6hONdy4kTg");
        analytics.page()
        }}();
      

      // search box
      

        ['desktop', 'mobile'].forEach(function(type) {
          var search = docsearch({
            apiKey: '768e823959d35bbd51e4b2439be13fb7',
            indexName: 'apollodata',
            inputSelector: '#' + type + '-search-input',
            autocompleteOptions: {
              dropdownMenuContainer: '.wrapper-' + type + '-search-results',
              debug: true
            },
            algoliaOptions: {
              hitsPerPage: 20
            }
          }).autocomplete;

          var sidebar = document.querySelector('.sidebar-content');
          search.on('autocomplete:opened', function() {
            sidebar.classList.add('searching');
          });
          search.on('autocomplete:closed', function() {
            sidebar.classList.remove('searching');
          });
          search.on('autocomplete:updated', function() {
            if (search.val() === '') {
              search.autocomplete.close();
            }
          });
        });
      

      
    </script>
  </body>
</html>
